<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>X32 Recorder</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background: #0f172a;
            color: #ffffff;
        }
        .card {
            background: #1f2937;
            border: none;
            border-radius: 14px;
        }
        .action-btn {
            width: 100%;
            height: 50px;
        }
        h3, h5 {
            color: #ffffff;
        }

        .action-btn {
            width: 100%;
            height: 52px;
            font-weight: 500;
        }
        #status {
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.6;
        }
    </style>
</head>

<body>
<div class="container py-4">

    <h3 class="mb-4">üéõ X32 Recorder</h3>

    <!-- STATUS -->
    <div class="card p-3 mb-4">
        <div id="status">Connecting...</div>
    </div>

    <!-- RECORDING -->
    <div class="card p-3 mb-4">
        <h5>Recording</h5>

        <div class="row g-3 mt-1">
            <div class="col-6">
                <button class="btn btn-danger action-btn" onclick="startRecord()">
                    Record
                </button>
            </div>
            <div class="col-6">
                <button class="btn btn-secondary action-btn" onclick="stopRecord()">
                    Stop
                </button>
            </div>
        </div>
    </div>

    <!-- PLAYBACK + MANAGE -->
    <div class="card p-3">
        <h5>Playback & File Management</h5>

        <select id="fileSelect" class="form-select mb-3"></select>

        <input type="range" class="form-range mb-4" id="seekbar" value="0">

        <div class="row g-3">
            <div class="col-6">
                <button class="btn btn-success action-btn" onclick="play()">Play</button>
            </div>
            <div class="col-6">
                <button class="btn btn-secondary action-btn" onclick="stopPlay()">Stop</button>
            </div>
            <div class="col-6">
                <button class="btn btn-warning action-btn" data-bs-toggle="modal" data-bs-target="#renameModal">
                    Rename
                </button>
            </div>
            <div class="col-6">
                <button class="btn btn-outline-danger action-btn" onclick="deleteFile()">
                    Delete
                </button>
            </div>
        </div>
    </div>

</div>

<!-- RENAME MODAL -->
<div class="modal fade" id="renameModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-0">
                <h5 class="modal-title">Rename File</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input id="renameInput" class="form-control" placeholder="New filename">
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="confirmRename()">Rename</button>
            </div>
        </div>
    </div>
</div>



<!-- ERROR MODAL -->
<div class="modal fade" id="errorModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger">Error</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                    OK
                </button>
            </div>
        </div>
    </div>
</div>










<script>
    const socket = io();
    const statusDiv = document.getElementById("status");
    const fileSelect = document.getElementById("fileSelect");
    const renameModal = new bootstrap.Modal(document.getElementById('renameModal'));

    // ---------- SOCKET LISTENERS ----------

    socket.on("status", (data) => {
        statusDiv.innerHTML =
            "X32: " + (data.x32 ? "‚úÖ Connected" : "‚ùå Not Found") +
            "<br>Recording: " + (data.recording ? "‚óè YES" : "‚Äî") +
            "<br>Playing: " + (data.playing ? "‚ñ∂ YES" : "‚Äî");
    });

    socket.on("files", (files) => {
        const current = fileSelect.value;
        fileSelect.innerHTML = "";

        files.forEach(f => {
            const opt = document.createElement("option");
            opt.value = f;
            opt.text = f;
            fileSelect.appendChild(opt);
        });

        if (files.includes(current)) fileSelect.value = current;
    });

    // ---------- ACTIONS ----------

    function startRecord() {
        socket.emit("start_record");
    }

    function stopRecord() {
        socket.emit("stop_record");
    }

    function play() {
        socket.emit("play", {file: fileSelect.value});
    }

    function stopPlay() {
        socket.emit("stop_play");
    }

    function confirmRename() {
        const newName = document.getElementById("renameInput").value;
        if (!newName) return;

        socket.emit("rename", {
            old: fileSelect.value,
            new: newName
        });

        document.getElementById("renameInput").value = "";
        renameModal.hide();
    }

    function deleteFile() {
        if (!confirm("Delete file?")) return;

        socket.emit("delete", {
            file: fileSelect.value
        });
    }

    // ------------ ERROR ACTIONS -----------


    const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
    const errorMessage = document.getElementById('errorMessage');

    socket.on("app_error", (data) => {
        console.log(' ERROR received:', data);
        showErrorModal(data.msg);
    });

    function showErrorModal(message) {
        errorMessage.textContent = message;
        errorModal.show();
    }
</script>

</body>
</html>


}